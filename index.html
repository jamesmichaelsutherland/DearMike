<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Send Mike a Message</title>
<style>
  :root{ --bg:#000; --fg:#fff; --muted:#bdbdbd; --accent:#fff; }
  html,body{height:100%; margin:0; background:var(--bg); color:var(--fg); font-family: "IBM Plex Mono", ui-monospace, Menlo, Monaco, "Roboto Mono", monospace;}
  .wrap{min-height:100%; display:flex; align-items:center; justify-content:center; padding:32px; box-sizing:border-box;}
  .card{max-width:720px; width:100%; text-align:left;}
  .center{display:flex; flex-direction:column; gap:18px; align-items:flex-start;}
  #intro { font-size:20px; line-height:1.2; color:var(--muted); margin-bottom:12px; height:44px; }
  #mikeIs { font-size:28px; color:var(--fg); }
  #phrase { font-size:20px; color:var(--muted); min-height:28px; margin-top:6px; opacity:0; transition:opacity .28s ease; }
  .fade-in{ opacity:1 !important; }
  .cursor { display:inline-block; width:10px; margin-left:6px; animation:blink 1s steps(2,start) infinite; color:var(--fg); }
  @keyframes blink { 0% {opacity:1} 50%{opacity:0} 100%{opacity:1} }
  #prompt { font-size:28px; margin-top:8px; color:var(--fg); display:flex; gap:8px; align-items:center; }
  form{ width:100%; margin-top:10px; display:flex; flex-direction:column; gap:10px; }
  input[type="text"], input[type="email"], textarea{ background:transparent; border:1px solid rgba(255,255,255,0.08); color:var(--fg); padding:12px; border-radius:8px; font-size:16px; outline:none; }
  input::placeholder, textarea::placeholder { color:rgba(255,255,255,0.35); }
  textarea{ min-height:160px; resize:vertical; }
  .meta { display:flex; justify-content:space-between; align-items:center; gap:12px; }
  #wordCount { color:var(--muted); font-size:14px; }
  button { background:transparent; border:1px solid rgba(255,255,255,0.12); color:var(--fg); padding:10px 16px; border-radius:8px; cursor:pointer; font-size:16px; }
  button:disabled { opacity:0.45; cursor:not-allowed; }
  #status { color:var(--muted); margin-top:8px; font-size:15px; }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div id="intro" class="center" aria-live="polite">
      <div id="mikeIs">"Mike" is…</div>
      <div id="phrase" aria-hidden="true"></div>
    </div>

    <div id="compose" hidden>
      <div id="prompt">Dear Mike<span class="cursor" aria-hidden="true">_</span></div>

      <form id="msgForm" autocomplete="off" novalidate>
        <input id="name" type="text" name="name" placeholder="Name (optional)" />
        <input id="email" type="email" name="email" placeholder="Email (required)" required />
        <textarea id="message" name="message" placeholder="Write up to 250 words…"></textarea>

        <div class="meta">
          <div id="wordCount">0 / 250 words</div>
          <button id="sendBtn" type="button">Send — $5</button>
        </div>

        <div id="status" hidden></div>
      </form>
    </div>
  </div>
</div>

<script>
/* ====================== CONFIG ====================== */
const APPS_SCRIPT_WEBHOOK = "https://script.google.com/macros/s/AKfycbzb6pcahAq5YeDTQcF6317vO7m5M7YPMTgFE51IJ8kcvdFDyy7xeFGxKi_emfQ8ytRXVQ/exec";
const CLIENT_SECRET = "supersecretstring123";
const STRIPE_PAYMENT_LINK = "https://buy.stripe.com/9B64gA2hx1R40934Zo4ko00";

/* ====================== Phrase animation ====================== */
const phrases = [
  "a real human, not AI",
  "a curious listener",
  "a business consultant",
  "a parent. a spouse.",
  "a leader. a teacher.",
  "a reader. a writer."
];

const phraseEl = document.getElementById('phrase');
const introEl = document.getElementById('intro');
const composeEl = document.getElementById('compose');

function delay(ms){ return new Promise(r=>setTimeout(r, ms)); }

async function showIntroSequence(){
  await delay(350);
  for (let i=0; i<phrases.length; i++){
    phraseEl.textContent = phrases[i];
    phraseEl.classList.add('fade-in');
    await delay(1000);
    phraseEl.classList.remove('fade-in');
    await delay(160);
  }
  await delay(200);
  introEl.style.display='none';
  composeEl.hidden = false;
  document.getElementById('message').focus();
}

/* ====================== Word count & validation ====================== */
const messageEl = document.getElementById('message');
const nameEl = document.getElementById('name');
const emailEl = document.getElementById('email');
const wordCountEl = document.getElementById('wordCount');
const statusEl = document.getElementById('status');
const sendBtn = document.getElementById('sendBtn');

function countWords(text){ return text.trim().split(/\s+/).filter(Boolean).length; }
function trimToWords(text,max){ return text.trim().split(/\s+/).filter(Boolean).slice(0,max).join(' '); }
function updateWordCount(){
  let words = countWords(messageEl.value);
  if(words>250) messageEl.value = trimToWords(messageEl.value,250);
  wordCountEl.textContent = `${countWords(messageEl.value)} / 250 words`;
  sendBtn.disabled = (countWords(messageEl.value)===0)||!validateEmail(emailEl.value);
}
function validateEmail(email){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email); }

/* ====================== Send message (pre-pay) ====================== */
sendBtn.addEventListener('click', async()=>{
  const message = messageEl.value.trim();
  const name = nameEl.value.trim();
  const email = emailEl.value.trim();
  if(!message){ alert("Type a message!"); return; }
  if(!validateEmail(email)){ alert("Enter a valid email!"); return; }

  try{
    const res = await fetch(APPS_SCRIPT_WEBHOOK,{
      method:'POST',
      body: JSON.stringify({
        clientSecret: CLIENT_SECRET,
        message: message,
        name: name,
        email: email
      })
    });
    const data = await res.json();
    if(data.error){ alert("Error: "+data.error); return; }

    // Open Stripe
    window.location.href = STRIPE_PAYMENT_LINK;

  } catch(err){
    alert("Unexpected error: "+err.message);
  }
});

/* ====================== Init ====================== */
document.addEventListener('DOMContentLoaded',()=>{
  showIntroSequence();
  messageEl.addEventListener('input', updateWordCount);
  emailEl.addEventListener('input', updateWordCount);
  nameEl.addEventListener('input', updateWordCount);
  updateWordCount();
});
</script>
</body>
</html>
